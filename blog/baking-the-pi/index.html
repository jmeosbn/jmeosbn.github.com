
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Home Theatre Pi (HTPi) - git-log(1)</title>
  <meta name="author" content="Jamie Osborne">

  
  <meta name="description" content="Just a collection of notes for setting up a clean image on the Raspberry Pi. Notes are current for XBian 1.0 Alpha 3. Basic Pi Tips Guide for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jmeosbn.github.com/blog/baking-the-pi/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="git-log(1)" type="application/atom+xml">
  <!--
	http://aijazansari.com/2012/08/27/how-to-customize-octopress-theme/
-->
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<meta name="google-site-verification" content="PubgJ00VUIj1r0qaB3oR0KwXirQKu3XAhBh0YduPdS0" />

  

</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1><a href="/">git-log(1)</a></h1>
  
</hgroup>

</header>
  
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Home Theatre Pi (HTPi)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-17T19:13:00+00:00" pubdate data-updated="true">Dec 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Just a collection of notes for setting up a clean image on the Raspberry Pi.</p>

<p>Notes are current for <a href="http://www.xbian.org">XBian</a> 1.0 Alpha 3.</p>

<!-- more -->

<h2 id="basic-pi-tips">Basic Pi Tips</h2>

<ul>
  <li>Guide for navigating XBMC with the <a href="http://wiki.xbmc.org/index.php?title=Keyboard">keyboard</a></li>
  <li>Login using hostname with zeroconfig: <code>ssh user@host.local</code></li>
</ul>

<h2 id="pre-setup-on-pc-laptop-etc">Pre-setup, on PC, laptop, etc.</h2>

<p>Before setting up the Pi remotely, there are some things to do locally to ease logging in.  This will obviate the need to enter the password, or specify the full host name each time we access the Pi.</p>

<h3 id="copy-public-key-to-pi">Copy public key to Pi</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># remove any old, conflicting host entries</span>
</span><span class="line">ssh-keygen -R xbian.local
</span><span class="line">
</span><span class="line"><span class="c"># generate key pair if none already exists</span>
</span><span class="line"><span class="nb">test</span> -f ~/.ssh/id_rsa.pub <span class="o">||</span> ssh-keygen
</span><span class="line">
</span><span class="line"><span class="c"># password required until key installed</span>
</span><span class="line">ssh-copy-id xbian@xbian.local
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The easiest way to append a key to the remote user&rsquo;s <code>~/.ssh/authorized_keys</code> file is to use <code>ssh-copy-id</code> as shown above.  Download <a href="http://hg.mindrot.org/openssh/raw-file/tip/contrib/ssh-copy-id">ssh-copy-id</a> from source if you don&rsquo;t have it (<a href="http://www.commandlinefu.com/commands/view/10228/...if-you-have-sudo-access-you-could-just-install-ssh-copy-id-mac-users-take-note.-this-is-how-you-install-ssh-copy-id-">installation instructions</a>), this <a href="http://www.commandlinefu.com/commands/view/188/copy-your-ssh-public-key-to-a-server-from-a-machine-that-doesnt-have-ssh-copy-id">alternative method</a> should also work in most situations.</p>

<h3 id="add-an-alias-to-sshconfig">Add an alias to .ssh/config</h3>

<p>Locally define the alias <code>xb</code> to be used in place of <code>xbian@xbian.local</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nb">echo</span> <span class="s1">&#39;</span>
</span><span class="line"><span class="s1">Host xb</span>
</span><span class="line"><span class="s1">  User  xbian</span>
</span><span class="line"><span class="s1">  Hostname  xbian.local&#39;</span> &gt;&gt; ~/.ssh/config
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>With this alias defined, <code>ssh xb</code> and <code>sftp xb</code> can be used to login.</p>

<h2 id="first-login-tasks">First login tasks</h2>

<p>If you have any files stored locally, you can transfer them using <code>sftp</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># connect to the pi, using the `xb` alias defined above</span>
</span><span class="line">sftp xb
</span><span class="line">sftp&gt; put .profile
</span><span class="line">sftp&gt; <span class="nb">exit</span>
</span><span class="line">
</span><span class="line"><span class="c"># you can also use ctlr+d to logout</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Most of the commands below need root privileges on the Pi, as they alter the system configuration.  To run a single command with root privileges, prepend the <code>sudo</code> command to it.  To run many commands this way without typing <code>sudo</code> each time, first start a root shell with <code>sudo -s</code>; <em>remember to logout with &lsquo;exit&rsquo; or ctrl+d when finished</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># Login to the pi, using the `xb` alias</span>
</span><span class="line">ssh xb
</span><span class="line">
</span><span class="line"><span class="c"># xbian-config may run here, set it up as you like then exit</span>
</span><span class="line">
</span><span class="line"><span class="c"># Prevent future display of login message</span>
</span><span class="line">touch ~/.hushlogin
</span><span class="line">
</span><span class="line"><span class="c"># Use a root shell for the following commands</span>
</span><span class="line">sudo -s
</span><span class="line">
</span><span class="line"><span class="c"># Allow full use of sudo without needing password</span>
</span><span class="line"><span class="nb">echo</span> <span class="s1">&#39;%sudo  ALL=(ALL) NOPASSWD: ALL&#39;</span> &gt;&gt; /etc/sudoers
</span><span class="line">
</span><span class="line"><span class="c"># Prevent autorun of xbian-config.sh,</span>
</span><span class="line"><span class="c"># moving it to /usr/bin to be executable</span>
</span><span class="line">mv /etc/profile.d/xbian-config.sh /usr/bin
</span><span class="line">chmod +x /usr/bin/xbian-config.sh
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="update-packages">Update packages</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get update <span class="o">&amp;&amp;</span> apt-get upgrade
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="fake-a-hw-clock-based-on-recent-timestamp">Fake a hw clock based on recent timestamp</h2>

<p>The Pi doesn&rsquo;t have any hardware to track time while powered off, so it uses Internet time servers to set its clock during startup. If the Pi is likely to be without Internet access, you can use fake-hwclock to set the clock to the last known date and time.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">touch /etc/init.d/hwclock.sh
</span><span class="line">/etc/init.d/ntp restart
</span><span class="line">apt-get install ntpdate fake-hwclock
</span><span class="line">ntpdate-debian
</span><span class="line">dpkg-reconfigure tzdata
</span><span class="line">sed -i <span class="s1">&#39;s/^exit 0/ntpdate-debian\nexit 0/g&#39;</span> /etc/rc.local
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="generate-new-rsa-host-keys">Generate new RSA host keys</h2>

<p>These keys confirm the identity of the Pi, to prevent a malicious host from intercepting the remote login process.  Not so important for your HTPi, but good standard security practice.  Also recommended if you have more than one Pi.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
</span><span class="line">ssh-keygen -t rsa1 -f /etc/ssh/ssh_host_key
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="install-mono">Install Mono</h2>

<p>Basic mono setup to run and compile command line tools.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install mono-devel mono-gmcs mono-csharp-shell
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="packages-from-raspbian">Packages from Raspbian</h2>

<p>Some standard packages that are usually excluded from the xbian distro, as they are not required for use of xbmc only.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install psmisc usbutils omxplayer
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br /></p>

<h1 id="useful-extras-not-always-used">Useful extras, not always used</h1>

<p>Stuff used infrequently, or currently being tested</p>

<h2 id="installing-iplayer-and-4od-itv-5">Installing iPlayer (and 4od, ITV, 5)</h2>

<p>Download the latest versions from the links below, then open the zip files directly from xbmc&rsquo;s addons page.</p>

<p><a href="http://code.google.com/p/xbmc-iplayerv2/downloads/list">http://code.google.com/p/xbmc-iplayerv2/downloads/list</a><br />
<a href="http://code.google.com/p/mossy-xbmc-repo/downloads/list">http://code.google.com/p/mossy-xbmc-repo/downloads/list</a><br />
<a href="http://code.google.com/p/xbmc-itv-player/downloads/list">http://code.google.com/p/xbmc-itv-player/downloads/list</a>  </p>

<h2 id="useful-packages">Useful packages</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install fs2resize exfat-fuse
</span><span class="line">apt-get install clang geany
</span><span class="line">apt-get install sysv-rc-conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="testing-pvr">Testing PVR</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install vdr-plugin-dvbsddevice
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="setting-up-webcam">Setting up webcam</h2>

<p>Use &lsquo;motion&rsquo; or &lsquo;fswebcam&rsquo;, motion may need a default cfg copying</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install motion
</span><span class="line">cp /etc/default/motion /etc/motion/motion.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br /></p>

<h1 id="troubleshooting--backup">Troubleshooting / backup</h1>

<p>Some useful commands and procedures</p>

<h2 id="backup-xbmc-settings">Backup XBMC settings</h2>

<ul>
  <li>Settings, addons etc. are in ~/.xbmc</li>
  <li>.xbmc/userdata - preferences etc</li>
  <li>.xbmc/addons - binaries, themes</li>
  <li>.xbmc/addons/packages - original downloads, can use with &ldquo;install from zip&rdquo;</li>
</ul>

<h2 id="clear-cached-network-adapter">Clear cached network adapter</h2>

<p>(needed for switching cards between devices)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nb">echo</span> | sudo tee /etc/udev/rules.d/70-persistent-net.rules
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="quick-tips">Quick Tips</h2>

<ul>
  <li>You can detect hdmi audio modes: <code>/opt/vc/bin/tvservice -a</code></li>
  <li>Setup CEC remote over hdmi from console: <code>cec-config</code></li>
</ul>

<p><br /></p>

<h1 id="not-usedneeded-with-recent-versions">Not used/needed with recent versions</h1>

<p>Previously useful functionality or workarounds</p>

<h2 id="enable-wifi-adapter">Enable WiFi adapter</h2>

<p>XBian includes WiFi configuration as part of xbian-config.sh, these instructions are for a manual setup.</p>

<p><em>From the instructions <a href="http://www.savagehomeautomation.com/raspi-airlink101">posted here</a></em></p>

<p>Use <code>lsusb</code> to check that the adapter is recognised, and <code>lsmod</code> to check the kernel module (e.g. <code>8192cu</code>) is loaded.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo nano /etc/network/interfaces
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Make sure the following lines exist, adding them as needed:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">auto wlan0
</span><span class="line">allow-hotplug wlan0
</span><span class="line">iface wlan0 inet manual
</span><span class="line">wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You may have the line <code>wireless-power off</code> in this file, which relates to power <strong><em>management</em></strong> only.  I commented it out as it resulted in errors logged during <code>ifup</code> and power management remained off without it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Add your network details using the following template:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">network</span><span class="o">={</span>
</span><span class="line"><span class="nv">ssid</span><span class="o">=</span><span class="s2">&quot;YOUR-NETWORK-SSID&quot;</span>
</span><span class="line"><span class="nv">proto</span><span class="o">=</span>WPA2
</span><span class="line"><span class="nv">key_mgmt</span><span class="o">=</span>WPA-PSK
</span><span class="line"><span class="nv">pairwise</span><span class="o">=</span>CCMP TKIP
</span><span class="line"><span class="nv">group</span><span class="o">=</span>CCMP TKIP
</span><span class="line"><span class="nv">psk</span><span class="o">=</span><span class="s2">&quot;YOUR-WLAN-PASSWORD&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Reinitialise the adapter, and check it&rsquo;s connected.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo ifdown wlan0
</span><span class="line">sudo ifup wlan0
</span><span class="line"><span class="c"># you may get some errors here, even when successful</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Use <code>iwconfig</code> to view wifi adapter info and <code>ifconfig</code> for general network info.</p>

<h2 id="fix-ssh-access-using-public-key">Fix ssh access using public key</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># must be owned by root</span>
</span><span class="line">chown root: ~ ~/.ssh
</span><span class="line"><span class="c"># no write for others</span>
</span><span class="line">chmod <span class="nv">a</span><span class="o">=</span>rx,u+w  ~
</span><span class="line">
</span><span class="line"><span class="c"># no access for others</span>
</span><span class="line">chmod -R go-rwx ~/.ssh
</span><span class="line"><span class="c"># public key can be readable</span>
</span><span class="line">chmod a+r ~/.ssh/id_rsa.pub
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="download-openssh-sftp-server">Download OpenSSH sftp server</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get -d install openssh-server
</span><span class="line">cp /var/cache/apt/archives/openssh-server_*.deb .
</span><span class="line">dpkg-deb -X openssh-server_*.deb sftp
</span><span class="line">cp sftp/usr/lib/openssh/sftp-server /usr/lib/
</span><span class="line">rm -r sftp openssh-server_*.deb
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="change-hostname">Change Hostname</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo nano /etc/hostname <span class="c"># enter the desired name</span>
</span><span class="line">sudo nano /etc/hosts <span class="c"># replace the hostname</span>
</span><span class="line">sudo /etc/init.d/hostname.sh start <span class="c"># to enable the changes</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="update-firmware-without-kernel">Update firmware without kernel</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">wget http://goo.gl/1BOfJ -O /usr/bin/rpi-update <span class="o">&amp;&amp;</span> chmod +x /usr/bin/rpi-update
</span><span class="line"><span class="nv">SKIP_KERNEL</span><span class="o">=</span>1 rpi-update 128
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="install-shairport">Install Shairport</h2>

<p>Instructions found <a href="http://tomsolari.id.au/post/27169019561/airplay-music-streaming-on-raspberry-pi">here</a> (alt site <a href="http://cheeftun.appspot.com/trouch.com/2012/08/03/airpi-airplay-audio-with-raspberry/">here</a>)</p>

<p>A change in IOS 6 <a href="http://jordanburgess.com/post/38986434391/raspberry-pi-airplay">requires Perl Net-SDP</a> module to installed.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">git clone https://github.com/njh/perl-net-sdp.git perl-net-sdp
</span><span class="line"><span class="nb">cd </span>perl-net-sdp
</span><span class="line">perl Build.PL
</span><span class="line">sudo ./Build
</span><span class="line">sudo ./Build <span class="nb">test</span>
</span><span class="line">sudo ./Build install
</span><span class="line"><span class="nb">cd</span> ..
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># do as root</span>
</span><span class="line">sudo -s
</span><span class="line">apt-get install alsa-utils
</span><span class="line">modprobe snd_bcm2835
</span><span class="line"><span class="c"># optionally set to headphone output</span>
</span><span class="line"><span class="c"># amixer cset numid=3 1</span>
</span><span class="line"><span class="c"># optionally restore to hdmi output</span>
</span><span class="line"><span class="c"># amixer cset numid=3 2</span>
</span><span class="line">apt-get install build-essential libssl-dev libcrypt-openssl-rsa-perl libao-dev libio-socket-inet6-perl libwww-perl avahi-utils pkg-config
</span><span class="line">wget https://github.com/albertz/shairport/zipball/master
</span><span class="line">unzip master
</span><span class="line"><span class="nb">cd </span>albertz-shairport-*
</span><span class="line">make install
</span><span class="line">cp shairport.init.sample /etc/init.d/shairport
</span><span class="line"><span class="c"># add to start of shairport: modprobe snd_bcm2835</span>
</span><span class="line">nano /etc/init.d/shairport
</span><span class="line"><span class="c"># optionally edit name of service (remove port number):</span>
</span><span class="line">nano /usr/local/bin/shairport.pl
</span><span class="line">insserv shairport
</span><span class="line"><span class="c"># manually start [services](http://pi-raspberry.blogspot.co.uk/2012/08/shairport-raspberry-pi.html)</span>
</span><span class="line">service avahi-daemon start
</span><span class="line">/etc/init.d/shairport start
</span><span class="line"><span class="c"># exit root</span>
</span><span class="line"><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jamie Osborne</span></span>

      








  


<time datetime="2012-12-17T19:13:00+00:00" pubdate data-updated="true">Dec 17<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/arm/'>arm</a>, <a class='category' href='/blog/categories/htpc/'>htpc</a>, <a class='category' href='/blog/categories/pi/'>pi</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jmeosbn.github.com/blog/baking-the-pi/" data-via="jmeosbn" data-counturl="http://jmeosbn.github.com/blog/baking-the-pi/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/stellaris-virtual-serial-device/" title="Previous Post: Stellaris Virtual Serial Device">&laquo; Stellaris Virtual Serial Device</a>
      
      
        <a class="basic-alignment right" href="/blog/pi-box/" title="Next Post: Dropbox on Pi">Dropbox on Pi &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jamie Osborne -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
