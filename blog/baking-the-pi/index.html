
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Home Theatre Pi (HTPi) - jmeosbn</title>
  <meta name="author" content="Jamie Osborne">

  
  <meta name="description" content="A collection of notes for setting up a clean image of XBian (1.0 Beta 1) on the Raspberry Pi. Jump to first login tasks if you have already set up &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jmeosbn.github.io/blog/baking-the-pi/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="jmeosbn" type="application/atom+xml">
  
  <!-- Google site verification -->
  <meta name="google-site-verification" content="PubgJ00VUIj1r0qaB3oR0KwXirQKu3XAhBh0YduPdS0" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42399191-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jmeosbn</a></h1>
  
</hgroup>

</header>
  
    <nav role="navigation"><ul class="main-navigation" data-subscription="rss">
    <li><a href="/">jmeosbn</a></li>
  <li><a href="/blog/archives">archives</a></li>

  
  <li><a href="feed://jmeosbn.github.io/atom.xml" rel="subscribe-rss-no-icon" title="Subscribe via RSS">rss</a></li>
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jmeosbn.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
</nav>
  
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Home Theatre Pi (HTPi)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-17T19:13:00+00:00" pubdate data-updated="true">Dec 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>A collection of notes for setting up a clean image of <a href="http://www.xbian.org">XBian</a> (1.0 Beta 1) on the Raspberry Pi.</p>

<!-- more -->

<p>Jump to <a href="/blog/baking-the-pi/#first-login-tasks">first login tasks</a> if you have already set up terminal access to the Pi.</p>

<ul id="markdown-toc">
  <li><a href="/blog/baking-the-pi/#basic-pi-tips">Basic Pi Tips</a></li>
  <li><a href="/blog/baking-the-pi/#pre-setup-on-pc-laptop-etc">Pre-setup; on PC, laptop, etc.</a></li>
  <li><a href="/blog/baking-the-pi/#transfer-files">Transfer files</a></li>
  <li><a href="/blog/baking-the-pi/#first-login-tasks">First login tasks</a></li>
  <li><a href="/blog/baking-the-pi/#change-hostname">Change Hostname</a></li>
  <li><a href="/blog/baking-the-pi/#fake-a-hardware-clock">Fake a hardware clock</a></li>
  <li><a href="/blog/baking-the-pi/#link-settings-to-root-profile">Link settings to root profile</a></li>
  <li><a href="/blog/baking-the-pi/#generate-new-rsa-host-keys">Generate new RSA host keys</a></li>
  <li><a href="/blog/baking-the-pi/#configure-wifi-and-bluetooth">Configure WiFi and Bluetooth</a></li>
  <li><a href="/blog/baking-the-pi/#ttl-serial-console">TTL serial console</a></li>
  <li><a href="/blog/baking-the-pi/#regional-system-settings">Regional system settings</a></li>
  <li><a href="/blog/baking-the-pi/#build-and-install-wiringpi">Build and install WiringPi</a></li>
  <li><a href="/blog/baking-the-pi/#install-dbox-dropbox-tool">Install dbox (dropbox tool)</a></li>
  <li><a href="/blog/baking-the-pi/#install-mono">Install Mono</a></li>
  <li><a href="/blog/baking-the-pi/#setup-xbmc">Setup XBMC</a></li>
  <li><a href="/blog/baking-the-pi/#useful-extras-not-always-used">Useful extras, not always used</a></li>
  <li><a href="/blog/baking-the-pi/#troubleshooting-and-backup">Troubleshooting and backup</a></li>
  <li><a href="/blog/baking-the-pi/#not-used-with-recent-versions">Not used with recent versions</a></li>
</ul>

<h2 id="basic-pi-tips">Basic Pi Tips</h2>

<p>Guide for navigating XBMC with the <a href="http://wiki.xbmc.org/index.php?title=Keyboard">keyboard</a>.</p>

<h3 id="connecting-to-the-pi">Connecting to the Pi</h3>

<p>XBian names the default user account <code>xbian</code>, other distributions normally use <code>pi</code>.  The default password is <code>raspberry</code>.  XBian includes support for zeroconfig (via avahi-daemon), so it’s easier to find your Pi on the network<sup id="fnref:hostname"><a href="/blog/baking-the-pi/#fn:hostname" rel="footnote">1</a></sup>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># login using zeroconfig</span>
</span><span class="line">ssh xbian@xbian.local
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If zeroconfig can’t be used, you can <a href="/blog/baking-the-pi/#find-the-ip-address">find the Pi’s network IP address</a> and use that to login.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># login using IP address</span>
</span><span class="line">ssh xbian@192.168.1.10
</span><span class="line">
</span><span class="line"><span class="c"># login as user pi on raspbian</span>
</span><span class="line">ssh pi@192.168.1.10
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><em>Note: If multiple Pis are active on the same network, they should be given <a href="/blog/baking-the-pi/#change-hostname">unique hostnames</a>.</em></p>

<h2 id="pre-setup-on-pc-laptop-etc">Pre-setup; on PC, laptop, etc.</h2>

<p>Before setting up the Pi remotely, there are some things to do locally to ease logging in when using SSH.  This will obviate the need to enter a password, or specify the full host name each time we access the Pi.</p>

<h3 id="copy-public-key-to-pi">Copy public key to Pi</h3>

<p>If generating a new key pair, accept the default key location as suggested by <code>ssh-keygen</code> below.  While a passphrase is optional, anyone can use a copy of the unencrypted private key to authenticate with your identity.  Many operating systems are preconfigured to use <code>ssh-agent</code> or a similar utility, to avoid having to enter a passphrase multiple times (if at all).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># generate a key pair if none already exists</span>
</span><span class="line"><span class="nb">test</span> -f ~/.ssh/id_rsa.pub <span class="o">||</span> ssh-keygen
</span><span class="line">
</span><span class="line"><span class="c"># remove any old, conflicting host entries</span>
</span><span class="line">ssh-keygen -R xbian.local
</span><span class="line">
</span><span class="line"><span class="c"># password is required until the key is installed</span>
</span><span class="line">ssh-copy-id xbian@xbian.local
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The easiest way to append a key to the remote user’s <code>~/.ssh/authorized_keys</code> file is to use <code>ssh-copy-id</code> as shown above.  Download <a href="http://hg.mindrot.org/openssh/raw-file/tip/contrib/ssh-copy-id">ssh-copy-id</a> from source if your system doesn’t already have it (<a href="http://www.commandlinefu.com/commands/view/10228/...if-you-have-sudo-access-you-could-just-install-ssh-copy-id-mac-users-take-note.-this-is-how-you-install-ssh-copy-id-">installation instructions</a>), this <a href="http://www.commandlinefu.com/commands/view/188/copy-your-ssh-public-key-to-a-server-from-a-machine-that-doesnt-have-ssh-copy-id">alternative method</a> should also work in most situations.</p>

<h3 id="add-an-alias-to-sshconfig">Add an alias to .ssh/config</h3>

<p>Locally define the alias <code>xb</code>, to be used in place of <code>xbian@xbian.local</code> with commands such as <code>ssh xb</code> and <code>sftp xb</code>.  Enter the text below as a single command, or manually paste the quoted text into <code>~/.ssh/config</code> using <code>nano</code> or similar (the IP address can be used for Hostname if preferred).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nb">echo</span> <span class="s1">&#39;</span>
</span><span class="line"><span class="s1">Host xb</span>
</span><span class="line"><span class="s1">  User  xbian</span>
</span><span class="line"><span class="s1">  Hostname  xbian.local&#39;</span> &gt;&gt; ~/.ssh/config
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="transfer-files">Transfer files</h2>

<p>If you have previous files from your Pi stored locally, you can transfer them using <code>sftp</code>, <code>scp</code>, etc.  For easily transferring many arbitrary files , a GUI sftp client is recommended.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># connect to the pi, using the `xb` alias defined above</span>
</span><span class="line">sftp xb
</span><span class="line">sftp&gt; put .bash_aliases
</span><span class="line">sftp&gt; <span class="nb">exit</span>
</span><span class="line">
</span><span class="line"><span class="c"># you can also use ctlr+d to logout</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="first-login-tasks">First login tasks</h2>

<p>Most of the commands below need root privileges on the Pi, as they alter the system configuration.  To run a single command with root privileges, prepend the <code>sudo</code> command to it.  To run many commands this way without typing <code>sudo</code> each time, first start a root shell with <code>sudo -s</code>; <em>remember to logout with ‘exit’ or ctrl+d when finished</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># Login to the pi, using the `xb` alias</span>
</span><span class="line">ssh xb
</span><span class="line">
</span><span class="line"><span class="c"># xbian-config may run here, set it up as you like then exit</span>
</span><span class="line">
</span><span class="line"><span class="c"># Disable autorun of xbian-config</span>
</span><span class="line"><span class="c"># Use &#39;sudo xbian-config&#39; to run manually</span>
</span><span class="line"><span class="nb">echo </span>0 &gt; .xbian-config-start
</span><span class="line">
</span><span class="line"><span class="c"># Disable the login message</span>
</span><span class="line">touch ~/.hushlogin
</span><span class="line">
</span><span class="line"><span class="c"># Disable setting of the terminal title</span>
</span><span class="line">sed -i <span class="s1">&#39;/PS1=.*\][0-2];/s/^/##/&#39;</span> ~/.bashrc
</span><span class="line">
</span><span class="line"><span class="c"># Use a root shell for the following commands</span>
</span><span class="line">sudo -s
</span><span class="line">
</span><span class="line"><span class="c"># Change password for root and xbian users</span>
</span><span class="line">passwd <span class="o">&amp;&amp;</span> passwd xbian
</span><span class="line">
</span><span class="line"><span class="c"># Allow full use of sudo without needing password</span>
</span><span class="line"><span class="c"># note: XBian 1.0a4 made this much less essential</span>
</span><span class="line"><span class="nb">echo</span> <span class="s1">&#39;%sudo  ALL=(ALL) NOPASSWD: ALL&#39;</span> &gt;&gt; /etc/sudoers
</span><span class="line">
</span><span class="line"><span class="c"># Allow boot partition to be mounted</span>
</span><span class="line">sed -i <span class="s1">&#39;/\s\/boot\s/s/,noauto//&#39;</span> /etc/fstab
</span><span class="line">
</span><span class="line"><span class="c"># Update packages</span>
</span><span class="line">apt-get update <span class="o">&amp;&amp;</span> apt-get upgrade
</span><span class="line">
</span><span class="line"><span class="c"># Install some utilities and services</span>
</span><span class="line">apt-get install p7zip zip curl mediainfo avahi-daemon
</span><span class="line">
</span><span class="line"><span class="c"># Install gcc compiler, dev tools</span>
</span><span class="line">apt-get install gcc make git-core
</span><span class="line">
</span><span class="line"><span class="c"># Install scripting tools</span>
</span><span class="line">apt-get install ruby ruby-dev ri libsqlite3-dev npm
</span><span class="line"><span class="c"># Fix node binary being named nodejs</span>
</span><span class="line"><span class="nb">cd</span> /usr/bin; sudo ln -s nodejs node; <span class="nb">cd</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="change-hostname">Change Hostname</h2>

<p>If it’s likely the Pi won’t be the only one using the local network, then it should be given a unique host name.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">nano /etc/hostname               <span class="c"># enter the desired name</span>
</span><span class="line">nano /etc/hosts                  <span class="c"># replace the hostname</span>
</span><span class="line">/etc/init.d/hostname.sh start    <span class="c"># to enable the changes</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="fake-a-hardware-clock">Fake a hardware clock</h2>

<p>The Pi doesn’t have a real time clock, so it usually defaults to some point in the past until the time can be set correctly using the Internet.  To make the clock more consistent across power cycles, it can be initialised using the last recorded date and time.  <em>(note: previous distros required the <a href="/blog/baking-the-pi/#fake-a-hardware-clock-unabridged">unabridged instructions</a>.)</em></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install fake-hwclock
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="link-settings-to-root-profile">Link settings to root profile</h2>

<p>Occasionally you’ll want to use a root shell, and then be annoyed that your aliases etc. are not configured for the root user.  You can either copy the profile files into ~/root or, as shown here, link them symbolically so that any future modifications will be reflected.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># change to the home folder you want to link from</span>
</span><span class="line"><span class="nb">cd</span> ~xbian
</span><span class="line">
</span><span class="line"><span class="c"># define a list of dot files to link</span>
</span><span class="line"><span class="nv">dotfiles</span><span class="o">=</span><span class="s2">&quot;.profile .bashrc .bash_aliases .bash_logout .nanorc .toprc&quot;</span>
</span><span class="line">
</span><span class="line"><span class="c"># link each existing file into the root user&#39;s home folder</span>
</span><span class="line"><span class="k">for </span>i in <span class="nv">$dotfiles</span>; <span class="k">do</span> <span class="o">[</span> -f <span class="nv">$i</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> sudo ln -sfv ~+/<span class="nv">$i</span> ~root/; <span class="k">done</span>
</span><span class="line">
</span><span class="line"><span class="c"># hush login message</span>
</span><span class="line">sudo touch ~root/.hushlogin
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="generate-new-rsa-host-keys">Generate new RSA host keys</h2>

<p>These keys confirm the identity of the Pi, to prevent a malicious host from intercepting the remote login process.  Not so important for your HTPi, but good standard security practice.  Also recommended if you have <a href="/blog/baking-the-pi/#change-hostname">more than one Pi</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">rm /etc/ssh/ssh_host_*
</span><span class="line">dpkg-reconfigure openssh-server
</span><span class="line">
</span><span class="line"><span class="c"># remove old host key from clients using:</span>
</span><span class="line"><span class="c"># ssh-keygen -R xbian.local</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<!--
	ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
	ssh-keygen -t rsa1 -f /etc/ssh/ssh_host_key
-->

<h2 id="configure-wifi-and-bluetooth">Configure WiFi and Bluetooth</h2>

<p>XBian includes simple WiFi configuration as part of the xbian-config setup menu,  see <a href="/blog/baking-the-pi/#manually-configure-wifi-adapter">manual configuration</a> if you want finer control over the network settings (e.g. connecting to multiple networks).  My bluetooth adapter is not supported in the current build of Raspbian/XBian, but <a href="/blog/baking-the-pi/#configure-bluetooth-adapter">here is the procedure</a> I used when trying to get it running (confirmed working on a laptop running Ubuntu).</p>

<h2 id="ttl-serial-console">TTL serial console</h2>

<p>The display of full screen terminal programs becomes corrupted when using a TTL to USB serial connection to the Pi from Mac OS X.  Changing the terminal type enables use of programs such as <code>nano</code> and <code>xbian-config</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sed -i <span class="s1">&#39;/ttyAMA0/s/vt100$/xterm/&#39;</span> /etc/inittab
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="regional-system-settings">Regional system settings</h2>

<p>Both XBian and Raspbian have system setup menus, but neither seem to setup the console keyboard correctly for the en_GB layout.  The current solution I use is to install <code>keyboard-configuration</code>, which only seems to work once <code>console-setup</code> is also installed.</p>

<p><em>The latter package will change the console font, but this can be reverted during the commands shown below. Just choose the font you prefer, or choose ‘Do not change the boot/kernel font’.</em></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># Packages needed to change keyboard layout</span>
</span><span class="line">apt-get install console-setup keyboard-configuration
</span><span class="line">
</span><span class="line"><span class="c"># Configure keyboard settings</span>
</span><span class="line">dpkg-reconfigure keyboard-configuration
</span><span class="line">
</span><span class="line"><span class="c"># Configure console font</span>
</span><span class="line"><span class="c"># accept the defaults until the font selection screen</span>
</span><span class="line">dpkg-reconfigure console-setup
</span><span class="line">
</span><span class="line"><span class="c"># Configure time zone and locale</span>
</span><span class="line">dpkg-reconfigure tzdata
</span><span class="line">dpkg-reconfigure locales
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="build-and-install-wiringpi">Build and install WiringPi</h2>

<p><a href="https://projects.drogon.net/raspberry-pi/wiringpi">WiringPi</a> is a library to access the Pi’s GPIO, SPI, and I2C headers, modelled on the Arduino Wiring system.  It also includes the <code>gpio</code> utility for use of the libraries from the command prompt.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install gcc make git-core libi2c-dev
</span><span class="line">git clone git://git.drogon.net/wiringPi
</span><span class="line"><span class="nb">cd </span>wiringPi; ./build
</span><span class="line">
</span><span class="line"><span class="c"># test with gpio utility</span>
</span><span class="line">gpio readall
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="install-dbox-dropbox-tool">Install dbox (dropbox tool)</h2>

<p>Follow the <a href="https://github.com/kenpratt/dbox">dbox installation instructions</a> to set up the dropbox sdk developer keys and authorisation tokens.  To use dbox for automatic folder syncing, see my post: <a href="/blog/pi-box/">Dropbox on Pi</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install gcc make ruby ruby-dev libsqlite3-dev
</span><span class="line">gem install dbox
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="install-mono">Install Mono</h2>

<p>Basic mono setup to run and compile command line tools.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install mono-devel mono-gmcs mono-csharp-shell
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="setup-xbmc">Setup XBMC</h2>

<h3 id="xbmc-extensions">XBMC Extensions</h3>

<p>Use <code>wget</code> to download the latest versions from the links below, then open the zip files directly from xbmc’s addons page.</p>

<ul>
  <li><a href="http://code.google.com/p/xbmc-iplayerv2/downloads/list">http://code.google.com/p/xbmc-iplayerv2/downloads/list</a></li>
  <li><a href="http://code.google.com/p/mossy-xbmc-repo/downloads/list">http://code.google.com/p/mossy-xbmc-repo/downloads/list</a></li>
  <li><a href="http://code.google.com/p/xbmc-itv-player/downloads/list">http://code.google.com/p/xbmc-itv-player/downloads/list</a></li>
</ul>

<h3 id="xbmc-settings">XBMC Settings</h3>

<p>If you are storing media in the root folder of an NTFS formatted hard drive, you may see some system folders while using the video/audio file views.  You can hide these system folders, change other advanced xbmc behaviour, or preset/lock standard settings in <a href="http://wiki.xbmc.org/?title=Advancedsettings.xml">advancedsettings.xml</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>~/.xbmc/userdata/advancedsettings.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line"><span class="nt">&lt;video&gt;</span>
</span><span class="line">    <span class="c">&lt;!-- hide system folders from the video files view --&gt;</span>
</span><span class="line">    <span class="c">&lt;!-- you could also add these to &#39;excludefromscan&#39; --&gt;</span>
</span><span class="line">    <span class="nt">&lt;excludefromlisting&gt;</span>
</span><span class="line">        <span class="nt">&lt;regexp&gt;</span>(\$RECYCLE.BIN|System Volume Information)<span class="nt">&lt;/regexp&gt;</span>
</span><span class="line">    <span class="nt">&lt;/excludefromlisting&gt;</span>
</span><span class="line"><span class="nt">&lt;/video&gt;</span>
</span><span class="line"><span class="nt">&lt;audio&gt;</span>
</span><span class="line">    <span class="c">&lt;!-- do likewise for the audio files view --&gt;</span>
</span><span class="line">    <span class="nt">&lt;excludefromlisting&gt;</span>
</span><span class="line">        <span class="nt">&lt;regexp&gt;</span>(\$RECYCLE.BIN|System Volume Information)<span class="nt">&lt;/regexp&gt;</span>
</span><span class="line">    <span class="nt">&lt;/excludefromlisting&gt;</span>
</span><span class="line"><span class="nt">&lt;/audio&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="useful-extras-not-always-used">Useful extras, not always used</h2>

<p>Stuff used infrequently, or currently being tested</p>

<h3 id="packages-from-raspbian">Packages from Raspbian</h3>

<p>Some standard packages that are usually excluded from the xbian distro, as they are not required for use of xbmc only.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install omxplayer
</span><span class="line">
</span><span class="line"><span class="c"># included on xbian &gt;= 1.0b</span>
</span><span class="line">apt-get install psmisc usbutils
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="other-useful-packages">Other useful packages</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install fs2resize exfat-fuse
</span><span class="line">apt-get install clang geany
</span><span class="line">apt-get install sysv-rc-conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="find-the-ip-address">Find the IP address</h3>

<p>You can get the IP address from your Pi, by running either of the following commands locally on the device.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">ip r | grep -o <span class="s1">&#39;src.*&#39;</span>
</span><span class="line">
</span><span class="line">ifconfig 2&gt;&amp;1 | grep cast | grep -o <span class="s1">&#39;inet [^ ]*&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Connect to the address that has the same subnet (starts similar) as the IP address you will be connecting from, ignoring the localhost address (127.0.0.1).</p>

<p>If it isn’t possible to run a command locally on the Pi (e.g. there is no monitor or keyboard attached), you can either <a href="http://www.recantha.co.uk/blog/?p=2397">scan the network</a> or view ‘Attached Devices’ in your Router’s setup.  Look for a matching hostname or MAC address (which will start with <code>b8:27:eb</code> for the on-board LAN).</p>

<h3 id="testing-pvr">Testing PVR</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install vdr-plugin-dvbsddevice
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="setting-up-webcam">Setting up webcam</h3>

<p>Use ‘motion’ or ‘fswebcam’, motion may need a default cfg copying</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get install motion
</span><span class="line">cp /etc/default/motion /etc/motion/motion.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="configure-bluetooth-adapter">Configure bluetooth adapter</h3>

<p><a href="http://www.ctheroux.com/2012/08/a-step-by-step-guide-to-setup-a-bluetooth-keyboard-and-mouse-on-the-raspberry-pi/">Adapted from ctheroux</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># install bluetooth support and dependencies</span>
</span><span class="line">agi bluez python-gobject  <span class="c"># minimal?</span>
</span><span class="line">agi bluetooth bluez-utils  <span class="c"># full</span>
</span><span class="line">
</span><span class="line"><span class="c"># for management from the desktop</span>
</span><span class="line">agi blueman
</span><span class="line">
</span><span class="line"><span class="c"># check adapter is working*</span>
</span><span class="line">hcitool dev
</span><span class="line">
</span><span class="line"><span class="c"># scan for devices</span>
</span><span class="line">hcitool scan
</span><span class="line">
</span><span class="line"><span class="c"># pair with device, using the address listed from scan</span>
</span><span class="line">bluez-simple-agent hci0 XX:XX:XX:XX:XX:XX
</span><span class="line">
</span><span class="line"><span class="c"># trust the device</span>
</span><span class="line">bluez-test-device trusted XX:XX:XX:XX:XX:XX yes
</span><span class="line">
</span><span class="line"><span class="c"># connect to input device</span>
</span><span class="line">bluez-test-input hci0 XX:XX:XX:XX:XX:XX
</span><span class="line">
</span><span class="line"><span class="c"># adapter status</span>
</span><span class="line">hciconfig
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><em>*Note: a bluetooth adapter may be listed in <code>lsusb</code> and <code>hciconfig</code>, without being recognised by <code>hcitool</code>. This is the case with the belkin dongle I have, so use <code>hcitool</code> to check that a device is working properly.</em></p>

<h2 id="troubleshooting-and-backup">Troubleshooting and backup</h2>

<p>Some useful commands and procedures</p>

<h3 id="backup-settings">Backup settings</h3>

<ul>
  <li>Settings, addons etc. are in ~/.xbmc</li>
  <li>.xbmc/userdata - preferences etc</li>
  <li>.xbmc/addons - binaries, themes</li>
  <li>.xbmc/addons/packages - original downloads, can use with “install from zip”</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># backup profile settings</span>
</span><span class="line">zip -ry xbmc .xbmc/
</span><span class="line">zip -ry dotfiles .bash_aliases .nanorc .toprc .ssh
</span><span class="line">
</span><span class="line"><span class="c"># backup system config files</span>
</span><span class="line">sudo zip -ry basecfg /etc/wpa_supplicant/wpa_supplicant.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Or using tar..</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># backup profile settings</span>
</span><span class="line">tar -czf xbmc-backup.tar.gz .xbmc
</span><span class="line">
</span><span class="line"><span class="c"># restore profile settings</span>
</span><span class="line">sudo initctl stop xbmc
</span><span class="line">tar -xzf xbmc-backup.tar.gz
</span><span class="line">sudo initctl start xbmc
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="clear-cached-network-adapter">Clear cached network adapter</h3>

<p>(needed for switching cards between devices)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nb">echo</span> | sudo tee /etc/udev/rules.d/70-persistent-net.rules
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="quick-tips">Quick Tips</h3>

<ul>
  <li>You can detect hdmi audio modes: <code>/opt/vc/bin/tvservice -a</code></li>
  <li>Setup CEC remote over hdmi from console: <code>cec-config</code></li>
</ul>

<h2 id="not-used-with-recent-versions">Not used with recent versions</h2>

<p>Previously useful functionality or workarounds</p>

<h3 id="manually-configure-wifi-adapter">Manually configure WiFi adapter</h3>

<p><a href="http://www.savagehomeautomation.com/raspi-airlink101">Instructions adapted from here</a>.</p>

<p>Use <code>lsusb</code> to check that the adapter is recognised, and <code>lsmod</code> to check the kernel module (e.g. <code>8192cu</code>) is loaded.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo nano /etc/network/interfaces
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Make sure the following lines exist in the interfaces file, adding them as needed:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">allow-hotplug wlan0
</span><span class="line">iface wlan0 inet manual
</span><span class="line">wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You may have the line <code>wireless-power off</code> in this file, which relates to power <strong><em>management</em></strong> only.  I’ve commented it out as it resulted in errors logged during <code>ifup</code> and power management remained off without it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Add your network details to wpa_supplicant.conf, using the following template:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">network</span><span class="o">={</span>
</span><span class="line">  <span class="nv">ssid</span><span class="o">=</span><span class="s2">&quot;YOUR-NETWORK-SSID&quot;</span>
</span><span class="line">  <span class="nv">proto</span><span class="o">=</span>WPA2
</span><span class="line">  <span class="nv">key_mgmt</span><span class="o">=</span>WPA-PSK
</span><span class="line">  <span class="nv">pairwise</span><span class="o">=</span>CCMP TKIP
</span><span class="line">  <span class="nv">group</span><span class="o">=</span>CCMP TKIP
</span><span class="line">  <span class="nv">psk</span><span class="o">=</span><span class="s2">&quot;YOUR-WLAN-PASSWORD&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Reinitialise the adapter, and check it’s connected.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">sudo ifdown wlan0
</span><span class="line">sudo ifup wlan0
</span><span class="line"><span class="c"># you may get some errors here, even when successful</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Use <code>iwconfig</code> to view wifi adapter info and <code>ifconfig</code> for general network info.</p>

<h3 id="fake-a-hardware-clock-unabridged">Fake a hardware clock (unabridged)</h3>

<p>More complicated instructions, as used on previous versions of XBian.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">touch /etc/init.d/hwclock.sh
</span><span class="line">/etc/init.d/ntp restart
</span><span class="line">apt-get install ntpdate fake-hwclock
</span><span class="line">ntpdate-debian
</span><span class="line">dpkg-reconfigure tzdata
</span><span class="line">sed -i <span class="s1">&#39;s/^exit 0/ntpdate-debian\nexit 0/g&#39;</span> /etc/rc.local
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="fix-ssh-access-using-public-key">Fix ssh access using public key</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># must be owned by root</span>
</span><span class="line">chown root: ~ ~/.ssh
</span><span class="line"><span class="c"># no write for others</span>
</span><span class="line">chmod <span class="nv">a</span><span class="o">=</span>rx,u+w  ~
</span><span class="line">
</span><span class="line"><span class="c"># no access for others</span>
</span><span class="line">chmod -R go-rwx ~/.ssh
</span><span class="line"><span class="c"># public key can be readable</span>
</span><span class="line">chmod a+r ~/.ssh/id_rsa.pub
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="download-openssh-sftp-server">Download OpenSSH sftp server</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">apt-get -d install openssh-server
</span><span class="line">cp /var/cache/apt/archives/openssh-server_*.deb .
</span><span class="line">dpkg-deb -X openssh-server_*.deb sftp
</span><span class="line">cp sftp/usr/lib/openssh/sftp-server /usr/lib/
</span><span class="line">rm -r sftp openssh-server_*.deb
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="update-firmware-without-kernel">Update firmware without kernel</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">wget http://goo.gl/1BOfJ -O /usr/bin/rpi-update <span class="o">&amp;&amp;</span> chmod +x /usr/bin/rpi-update
</span><span class="line"><span class="nv">SKIP_KERNEL</span><span class="o">=</span>1 rpi-update 128
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="allow-xbmc-to-unmount-usb-drives">Allow XBMC to unmount USB drives</h3>

<p>XBian used to include the usbmount package to mount USB devices as soon as they are connected.  This prevented XBMC from bring able to use the udisk service to mount and unmount USB drives itself, due to root privileges being required to unmount devices mounted by usbmount.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># disable the usbmount package</span>
</span><span class="line">sed -i <span class="s1">&#39;/ENABLED=/s/=1/=0/&#39;</span> /etc/usbmount/usbmount.conf
</span><span class="line">
</span><span class="line"><span class="c"># optionally remove unused usbmount directories</span>
</span><span class="line"><span class="c"># umount /media/usb*; rmdir /media/usb*; rm /media/usb</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Drives can be unmounted manually using <code>udisks</code> without needing to be root, and members of the <code>plugdev</code> group can also use <code>pumount</code>.</p>

<h3 id="install-shairport">Install Shairport</h3>

<p>Instructions found <a href="http://tomsolari.id.au/post/27169019561/airplay-music-streaming-on-raspberry-pi">here</a> (alt site <a href="http://cheeftun.appspot.com/trouch.com/2012/08/03/airpi-airplay-audio-with-raspberry/">here</a>)</p>

<p>More recent instructions: http://lifehacker.com/5978594/turn-a-raspberry-pi-into-an-airplay-receiver-for-streaming-music-in-your-living-room</p>

<p>A change in IOS 6 <a href="http://jordanburgess.com/post/38986434391/raspberry-pi-airplay">requires Perl Net-SDP</a> module to installed.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">git clone https://github.com/njh/perl-net-sdp.git perl-net-sdp
</span><span class="line"><span class="nb">cd </span>perl-net-sdp
</span><span class="line">perl Build.PL
</span><span class="line">sudo ./Build
</span><span class="line">sudo ./Build <span class="nb">test</span>
</span><span class="line">sudo ./Build install
</span><span class="line"><span class="nb">cd</span> ..
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># do as root</span>
</span><span class="line">sudo -s
</span><span class="line">apt-get install alsa-utils
</span><span class="line">modprobe snd_bcm2835
</span><span class="line"><span class="c"># optionally set to headphone output</span>
</span><span class="line"><span class="c"># amixer cset numid=3 1</span>
</span><span class="line"><span class="c"># optionally restore to hdmi output</span>
</span><span class="line"><span class="c"># amixer cset numid=3 2</span>
</span><span class="line">apt-get install build-essential libssl-dev libcrypt-openssl-rsa-perl libao-dev libio-socket-inet6-perl libwww-perl avahi-utils pkg-config
</span><span class="line">wget https://github.com/albertz/shairport/zipball/master
</span><span class="line">unzip master
</span><span class="line"><span class="nb">cd </span>albertz-shairport-*
</span><span class="line">make install
</span><span class="line">cp shairport.init.sample /etc/init.d/shairport
</span><span class="line"><span class="c"># add to start of shairport: modprobe snd_bcm2835</span>
</span><span class="line">nano /etc/init.d/shairport
</span><span class="line"><span class="c"># optionally edit name of service (remove port number):</span>
</span><span class="line">nano /usr/local/bin/shairport.pl
</span><span class="line">insserv shairport
</span><span class="line"><span class="c"># manually start [services](http://pi-raspberry.blogspot.co.uk/2012/08/shairport-raspberry-pi.html)</span>
</span><span class="line">service avahi-daemon start
</span><span class="line">/etc/init.d/shairport start
</span><span class="line"><span class="c"># exit root</span>
</span><span class="line"><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="footnotes">
  <ol>
    <li id="fn:hostname">
      <p>It should be possible to connect with the hostname even without zeroconfig, e.g. <code>xbian@xbian</code> or <code>pi@raspberrypi</code> (on raspbian), but I’ve had no luck with this.<a href="/blog/baking-the-pi/#fnref:hostname" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jamie Osborne</span></span>

      








  


<time datetime="2012-12-17T19:13:00+00:00" pubdate data-updated="true">Dec 17<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/arm/'>arm</a>, <a class='category' href='/blog/categories/htpc/'>htpc</a>, <a class='category' href='/blog/categories/pi/'>pi</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jmeosbn.github.io/blog/baking-the-pi/" data-via="jmeosbn" data-counturl="http://jmeosbn.github.io/blog/baking-the-pi/" data-count="none">Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/stellaris-virtual-serial-device/" title="Previous Post: Stellaris Virtual Serial Device">&laquo; Stellaris Virtual Serial Device</a>
      
      
        <a class="basic-alignment right" href="/blog/pi-box/" title="Next Post: Dropbox on Pi">Dropbox on Pi &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1><a href="/blog/archives">Recent</a></h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/pi-box/">Dropbox on Pi</a>
      </li>
    
      <li class="post">
        <a href="/blog/baking-the-pi/">Home Theatre Pi (HTPi)</a>
      </li>
    
      <li class="post">
        <a href="/blog/stellaris-virtual-serial-device/">Stellaris Virtual Serial Device</a>
      </li>
    
      <li class="post">
        <a href="/blog/testing-the-stellaris-toolchain/">Testing the Stellaris Toolchain</a>
      </li>
    
      <li class="post">
        <a href="/blog/compiling-the-stellaris-toolchain/">Compiling the Stellaris Toolchain</a>
      </li>
    
      <li class="post">
        <a href="/blog/resources-for-using-git/">Resources for Using Git</a>
      </li>
    
  </ul>
</section>

<section>
  <h1><a href="https://github.com/jmeosbn">GitHub</a></h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jmeosbn',
            count: 15,
            skip_forks: true,
            skip_sites: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>




  <h1><a href="https://twitter.com/intent/user?screen_name=jmeosbn">Twitter</a></h1>




</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><div id="copyright">
  Copyright &copy; 2012 - 2013
</div>


<div id="license">
  <a rel="license" href="http://git.io/jmeosbn-license">
  
    <span id="license_text">CC BY-NC-SA</span>
  
  </a>
</div>


<div id="siteauthor">Jamie Osborne</div>

<div id="footer">
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</div>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
